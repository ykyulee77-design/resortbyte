# 🚨 기숙사 사진 업로드 문제 해결 가이드

## 현재 상황
Firebase Storage CORS 오류 및 네트워크 재시도 문제로 인해 기숙사 사진 업로드가 실패하고 있습니다.

## 해결 방법 (단계별)

### 1단계: Firebase Storage Rules 변경 (가장 중요!)

1. **Firebase Console 접속**
   - https://console.firebase.google.com/ 접속
   - 프로젝트 선택 (resortbyte)

2. **Storage Rules 변경**
   - 왼쪽 메뉴에서 "Storage" 클릭
   - "Rules" 탭 클릭
   - 기존 규칙을 모두 삭제하고 아래 규칙으로 교체:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if true;
    }
  }
}
```

3. **게시**
   - "게시" 버튼 클릭
   - 변경사항이 적용될 때까지 1-2분 대기

### 2단계: 네트워크 문제 해결

#### 2-1. 인터넷 연결 확인
- 인터넷 연결 상태 확인
- 방화벽 설정 확인
- VPN 사용 중인 경우 해제

#### 2-2. 파일 크기 최적화
- **자동 최적화**: 시스템이 자동으로 1MB 이하로 압축
- **수동 최적화**: 이미지 편집 프로그램으로 크기 조정
- **권장 크기**: 1MB 이하, 1920x1080 이하

#### 2-3. 브라우저 캐시 삭제
1. **브라우저 개발자 도구 열기**
   - F12 키 누르기
   - "Application" 또는 "Storage" 탭 클릭

2. **캐시 삭제**
   - "Clear storage" 또는 "Clear site data" 클릭
   - 페이지 새로고침 (Ctrl+F5)

### 3단계: 기숙사 사진 업로드 테스트

1. **구인자 대시보드 접속**
   - 로그인 후 구인자 대시보드로 이동

2. **기숙사 정보 관리**
   - "기숙사 정보 관리" 버튼 클릭
   - "사진 업로드" 섹션에서 이미지 선택

3. **업로드 테스트**
   - 작은 이미지 파일 (1MB 이하) 선택
   - 업로드 버튼 클릭
   - 브라우저 개발자 도구 Console에서 로그 확인

### 4단계: 재시도 로직 확인

시스템이 자동으로 3번까지 재시도합니다:
- 1차 시도 실패 → 1초 대기 후 재시도
- 2차 시도 실패 → 2초 대기 후 재시도
- 3차 시도 실패 → 최종 실패

### 5단계: 문제가 지속되는 경우

#### 5-1. 네트워크 연결 확인
- 인터넷 연결 상태 확인
- 방화벽 설정 확인
- 다른 네트워크에서 테스트

#### 5-2. 파일 형식 확인
- 지원되는 형식: JPG, PNG, GIF, WebP
- 파일 크기: 5MB 이하 (자동 최적화로 1MB 이하 권장)

#### 5-3. 브라우저 확인
- Chrome, Firefox, Edge 최신 버전 사용
- 시크릿 모드에서 테스트
- 다른 브라우저에서 테스트

### 6단계: 성공 후 보안 규칙 복원

업로드가 성공하면 보안 규칙으로 다시 변경:

```javascript
rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    match /accommodation-images/{fileName} {
      allow read, write: if request.auth != null;
    }
    
    match /{allPaths=**} {
      allow read, write: if request.auth != null;
    }
  }
}
```

## 디버깅 정보

### 브라우저 개발자 도구에서 확인할 정보:

1. **Console 탭**
   - "=== 이미지 업로드 시도 X/3 ===" 로그 확인
   - "파일 크기 최적화 중" 메시지 확인
   - "✅ 파일 업로드 성공!" 메시지 확인

2. **Network 탭**
   - Firebase Storage 요청 확인
   - CORS 오류 메시지 확인

### 일반적인 오류 코드:

- `storage/retry-limit-exceeded`: 네트워크 문제 (자동 재시도)
- `storage/unauthorized`: 인증 문제
- `storage/invalid-format`: 파일 형식 문제
- CORS 오류: Storage Rules 문제

## 추가 도움말

### 네트워크 문제 해결:
1. **인터넷 연결 확인**
   - ping google.com 실행
   - 다른 사이트 접속 테스트

2. **파일 크기 줄이기**
   - 이미지 편집 프로그램 사용
   - 온라인 이미지 압축 도구 사용

3. **브라우저 설정 확인**
   - 캐시 삭제
   - 쿠키 삭제
   - 시크릿 모드 사용

### 성공 확인 방법:

업로드 성공 시:
- Console에 "✅ 파일 업로드 성공!" 메시지 표시
- 기숙사 정보에 이미지 미리보기 표시
- 일자리 찾기 페이지에서 기숙사 사진 확인 가능

## 🆘 긴급 해결책

문제가 지속되는 경우:
1. **Firebase Storage Rules를 완전 개방** (firebase-storage-rules-emergency.txt 참조)
2. **파일 크기를 500KB 이하로 줄이기**
3. **다른 브라우저에서 테스트**
4. **다른 네트워크에서 테스트** 